import unittest

import numpy as np

from score_corners import scoreCorners
from tests.utils import read_test_data_from_pickle


def read_test_input_from(filename):
    test_data = read_test_data_from_pickle(filename)
    return test_data['img'], test_data['img_angle'], test_data['img_weight'], test_data['corners'], test_data['radius']


class ScoreCornersTest(unittest.TestCase):
    def test_scoreCorners(self):
        img, img_angle, img_weight, corners, radius = read_test_input_from('scoreCorner/data02.pkl')
        corners = scoreCorners(img, img_angle, img_weight, corners, radius, 0.01)

        np.testing.assert_almost_equal(np.array(
            [0.1403975101332953, 0.13879662617344465, 0.13537486785061956, 0.14263454370159293, 0.1409718571646737,
             0.12331330501519451, 0.13444672041297212, 0.11781147028070722, 0.11684888439863314, 0.13467559140712698,
             0.13434820272930534, 0.15179543191479425, 0.14088479827461267, 0.148636587281116, 0.13395440881357756,
             0.14086471156384012, 0.2079392382917215, 0.13524396380877043, 0.11458157333695114, 0.16264239403667896,
             0.16141478724480007, 0.15982746871069792, 0.23074701141647672, 0.1474586120165066, 0.14454151143142985,
             0.1292310307302245, 0.12941150168162646, 0.23305718511562298, 0.13824537460067465, 0.21797214938294496,
             0.13526785687487253, 0.15466014521887078, 0.1680684039091139, 0.15844486563180987, 0.21151414183006792,
             0.14848248891428933, 0.15906126701002168, 0.2266946994919988, 0.14686310620084447, 0.14236419544321466,
             0.21766895384071874, 0.14388203922581908, 0.15230245886351726, 0.1974926897431233, 0.19989467254331156,
             0.14664559481217881, 0.14372156942551484, 0.2048872466368272, 0.1673155060477685, 0.147493829538303,
             0.14096904792252377, 0.1398518153988735, 0.21648331416606256, 0.1347416020581, 0.22134978797124352,
             0.1527878023692233, 0.14752206675094964, 0.22821581776204178, 0.22481276204105727, 0.17647810836945804,
             0.2549523518060764, 0.24243127598330438, 0.15940980896737658, 0.14798232199221237, 0.16607517794669796,
             0.14204810318901043, 0.14648931384753391, 0.15556430507443458, 0.1858925413770852, 0.14182571235746355,
             0.21531151720842354, 0.15529006858658637, 0.23941255890830287, 0.2420093052405349, 0.24544889105871512,
             0.22860919763203158, 0.17704347311162105, 0.16947148764857203, 0.1597883079896921, 0.15219497506295446,
             0.2661251743258996, 0.15701234848271645, 0.14300013188272906, 0.1464207109615143, 0.22877610659089959,
             0.23146595575549211, 0.15302738998623894, 0.15779706927595502, 0.26243474207154777, 0.23585831386309725,
             0.2555941941864488, 0.23733829394971595, 0.2666100649618354, 0.17633599294257427, 0.1453529731640861,
             0.15854910589970989, 0.1664720788747015, 0.16274216937930347, 0.16283345374688918, 0.16398401881215394,
             0.23374610036470572, 0.23701470443827807, 0.14966991019867432, 0.24028893836378853, 0.13411819350832122,
             0.2191935413739034, 0.22846763091761754, 0.24545830521492568, 0.24664948659913458, 0.25084088158157775,
             0.2620915428735824, 0.1585689488343012, 0.15053287827256598, 0.15124973137334372, 0.1648782781117833,
             0.14534958930748074, 0.15791053084443887, 0.1334825984962666, 0.12594500730947897, 0.1359593884268303,
             0.23953229621172462, 0.27347895654865756, 0.2664795453375903, 0.21782873121449028, 0.25025854548933385,
             0.247203224242454, 0.22444824473589461, 0.2687319849137332, 0.256470492218978, 0.26060832671230694,
             0.2652471116178156, 0.017321707891564106, 0.25525036000852747, 0.2540877758056214, 0.2111714193183149,
             0.23175806554097278, 0.26518826331438144, 0.26813784849720934, 0.27225965404780694, 0.1213806849796275,
             0.13411942956224862, 0.1494160096010263, 0.13789240545111475, 0.14607258890721747, 0.15939562016435138,
             0.1469442686198307, 0.25674314450641766, 0.13375362967306362, 0.14522441875310366, 0.27476558331950685,
             0.22397815166861545, 0.2711924060350073, 0.14891439339083848, 0.26445455207145, 0.13938741133288446,
             0.14546845882855483, 0.15122972915523336, 0.14396953832406606, 0.2871102249172243, 0.13475084861515974,
             0.1336883930477717, 0.13600747866834698, 0.26110517804315053, 0.14264097820740257, 0.2465629791737662,
             0.23964482489723002, 0.14006306977279515, 0.13719647371544966, 0.1506135247266675, 0.1361063391624296,
             0.15291379732235708, 0.14125660403122156, 0.2626432688795801, 0.1304353662030744, 0.1326523060109118,
             0.23385745459241924, 0.13086712897420616, 0.25594399865903333, 0.23077154673466493, 0.24930243275701214,
             0.12444967899251924, 0.15182807030144208, 0.13167453330602907, 0.14848250793417705, 0.14943967271635977,
             0.1504922055264685, 0.12225096634791692, 0.14972671848441713, 0.1401014000791661, 0.260021134536387,
             0.288341330533348, 0.2310695274270571, 0.26916804903124913, 0.12449580997728453, 0.1397820216984477,
             0.1530409399824615, 0.12229276369464971, 0.13269929424199287, 0.128095187612127, 0.15364611494221397,
             0.1616536961174248, 0.25990187129619147, 0.2544454501517169, 0.1529363520372918, 0.22531587155977015,
             0.15143092957541632, 0.1460669535722131, 0.14875016941491234, 0.15543634192163883, 0.12805372482050725,
             0.15462375396045755, 0.1427473811103673, 0.2560635161645763, 0.14456892040974686, 0.27820306879271534,
             0.1675694168485272, 0.14288646273464445, 0.12291333351147647, 0.14244274170431515, 0.13998897165680596,
             0.12638031604334632, 0.14010875299523726, 0.14138701188602626, 0.28428947076512323, 0.14591326624589812,
             0.15813314230912345, 0.14966700031601432, 0.13716381700568359, 0.1523017727799897, 0.14214079317441006,
             0.15164102054734155, 0.1509416578885745, 0.15373366270676728, 0.142150018458791, 0.1318117694368346,
             0.1485375877359565, 0.1523018591311134, 0.12798493756258095, 0.11634184728102322, 0.12947964972728074,
             0.1096770091823151, 0.13458119517180844, 0.14165874129898165, 0.14661718171302704, 0.021544519953206453,
             0.019319119245272177, 0.024804045382561278, 0.01074389871165543, 0.018598348749739254,
             0.013137561156492757, 0.015389970991770282, 0.01104215744017856, 0.015499063884267325, 0.01934756711445694,
             0.016886911733140667, 0.017663915328864386, 0.01472342943982883, 0.011597282388757334,
             0.011037908384048141]), corners.score)
